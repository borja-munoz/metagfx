# MetaGFX - A backend-agnostic physically-based renderer

The goal of this project is to implement a physically-based renderer that has a common abstract core with implementations using different graphics APIs like Vulkan, Direct3D, Metal or WebGPU.

The implementation is mostly done using Claude models (i.e. Sonnet 4.5) and the roadmap has also been designed with the help of this LLM.

Files generated by Claude are stored in the `claude` directory.

## Current Features

**Rendering**:
- ✅ Physically-Based Rendering (PBR) with Cook-Torrance BRDF
- ✅ Metallic-roughness workflow (glTF 2.0 compliant)
- ✅ Normal mapping with derivative-based TBN calculation
- ✅ ACES filmic tone mapping
- ✅ Exposure control
- ✅ Ambient occlusion support

**Materials**:
- ✅ Full PBR material system (albedo, roughness, metallic, AO)
- ✅ Texture support (albedo, normal, metallic-roughness-AO combined)
- ✅ Material property fallback for non-textured objects

**Lighting**:
- ✅ Multiple light types (directional, point, spot)
- ✅ Up to 16 simultaneous lights
- ✅ Distance and cone attenuation
- ✅ Per-light intensity and color control

**Model Loading**:
- ✅ Assimp integration (OBJ, FBX, glTF, COLLADA)
- ✅ Embedded texture support (glTF/GLB)
- ✅ Procedural geometry (cube, sphere)
- ✅ Automatic material extraction from model files
- ✅ Runtime model switching with safe resource cleanup

**Camera**:
- ✅ FPS-style camera controls (WASD + QE for up/down)
- ✅ Click-and-drag mouse rotation
- ✅ Perspective and orthographic projection
- ✅ Scroll wheel zoom

**User Interface**:
- ✅ ImGui integration for runtime controls
- ✅ Model selection dropdown
- ✅ Exposure control slider
- ✅ Interactive demo window

**Graphics API**:
- ✅ Vulkan backend (complete)
- ⏳ Direct3D 12 (planned)
- ⏳ Metal (planned)
- ⏳ WebGPU (planned)

**Completed Milestones**:
- Milestone 2.2: Basic Material System
- Milestone 2.3: Textures and Samplers
- Milestone 3.1: Light System
- Milestone 3.2: PBR Rendering (Phases 1, 2, 4)

## Project Structure

```
metagfx/
├── CMakeLists.txt
├── README.md
├── .gitignore
├── setup.sh          (Linux/macOS)
├── setup.bat         (Windows)
├── assets/
│   ├── models/
│   ├── textures/
│   └── scenes/
├── claude/
│   ├── milestone_x_y/          
│   │   ├── milestone_x_y.md     (instructions)
│   │   ├── milestone_x_y.txt    (code)
├── external/
│   ├── CMakeLists.txt
│   ├── SDL/          (repo added as submodule)
│   ├── glm/          (repo added as submodule)
│   └── stb/          
├── include/
│   └── metagfx/
│       ├── core/
│       ├── rhi/
│       │   └── vulkan/
│       ├── scene/
│       └── renderer/
└── src/
    ├── app/
    ├── core/
    ├── rhi/
    │   └── vulkan
    ├── scene/
    └── renderer/
```

---

## Prerequisites

### All Platforms
- CMake 3.20 or higher
- C++20 compliant compiler
- Git

### Windows
- Visual Studio 2019/2022 OR
- MinGW-w64 with GCC 9+
- Vulkan SDK (from LunarG)

### Linux
- GCC 9+ or Clang 10+
- Vulkan SDK or vulkan-headers package
- Development libraries:
  ```bash
  sudo apt install build-essential cmake git
  sudo apt install libvulkan-dev
  sudo apt install libx11-dev libxrandr-dev libxinerama-dev libxcursor-dev libxi-dev
  ```

### macOS
- Xcode Command Line Tools
- CMake (via Homebrew)
- Vulkan SDK (MoltenVK)
  ```bash
  brew install cmake 
  brew install vulkan-headers vulkan-loader molten-vk glslang
  ```

---

## Quick Setup (Recommended)

### Linux/macOS

```bash
chmod +x setup.sh
./setup.sh
```

### Windows

```batch
setup.bat
```

---

## Manual Setup (Alternative)

### 1. Create external directory and navigate to it
```bash
mkdir external
cd external
```

### 2. Clone SDL3
```bash
git clone https://github.com/libsdl-org/SDL.git
cd SDL
git checkout main
cd ..
```

### 3. Clone GLM
```bash
git clone https://github.com/g-truc/glm.git
```

### 4. Download stb
```bash
mkdir stb
cd stb
curl -O https://raw.githubusercontent.com/nothings/stb/master/stb_image.h
cd ..
```

---

## Building the Project

### Windows (Visual Studio)

```bash
# From project root
mkdir build
cd build
cmake .. -G "Visual Studio 17 2022" -A x64
cmake --build . --config Release
```

Or open `build/PhysicallyBasedRenderer.sln` in Visual Studio.

### Windows (MinGW)

```bash
mkdir build
cd build
cmake .. -G "MinGW Makefiles"
cmake --build . --config Release
```

### Linux

```bash
mkdir build
cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j$(nproc)
```

### macOS

```bash
mkdir build
cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j$(sysctl -n hw.ncpu)
```

---

## Running

After building, the executable will be in `build/bin/`:

### Windows
```bash
cd build\bin
metagfx.exe
```

### Linux/macOS
```bash
cd build/bin
./metagfx
```

### Controls

- **ESC**: Exit application
- **W/A/S/D**: Move forward/left/back/right
- **Q/E**: Move down/up
- **Mouse Drag**: Rotate camera (click and drag)
- **Mouse Wheel**: Zoom in/out (FOV adjustment)
- **N**: Load next model
- **P**: Load previous model
- **1-4**: Load specific model by index

---

## CMake Build Options

```bash
cmake .. -DMETAGFX_USE_VULKAN=ON      # Enable Vulkan support (default: ON)
cmake .. -DMETAGFX_USE_D3D12=ON       # Enable D3D12 support (default: OFF)
cmake .. -DMETAGFX_USE_METAL=ON       # Enable Metal support (default: OFF)
cmake .. -DMETAGFX_USE_WEBGPU=ON      # Enable WebGPU support (default: OFF)
cmake .. -DMETAGFX_BUILD_TESTS=ON     # Build tests (default: OFF)
```

---

## Resources

Models and scenes repositories:

- [Benedikt Bitterli Rendering Resources](https://benedikt-bitterli.me/resources/). Different PBR scenes in Tungsten, Mitsuba and PBRT formats. 
- [McGuire Computer Graphics Archive](https://casual-effects.com/data/). Meshes in OBJ format.
- [PBRT-v4 Scenes](https://github.com/mmp/pbrt-v4-scenes). Github repo with scenes for PBRT v4.
- [ambientCG](https://ambientcg.com). 3D assets including PBR surfaces, HDRIs, models...
- [Open Research Content Archive](https://developer.nvidia.com/orca). 3D assets donated by Amazon Lumberyard, SpeedTree, NVIDIA and Epic in FBX format.
- [glTF 2.0 Sample Models](https://github.com/KhronosGroup/glTF-Sample-Models/blob/main/2.0/README.md). Models with PBR features.